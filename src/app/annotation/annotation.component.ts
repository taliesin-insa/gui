import {Component, OnInit} from '@angular/core';
import {Router} from '@angular/router';
import {Snippet} from '../model/Snippet';
import {FormArray, FormBuilder, FormGroup} from '@angular/forms';
import {HttpClient} from '@angular/common/http';
import {HandleError, HttpErrorHandler} from '../services/http-error-handler.service';
import {catchError, timeout} from 'rxjs/operators';
import {ErrorMessageService} from '../services/error-messages.service';

@Component({
  // tslint:disable-next-line:component-selector
  selector: 'annotation',
  templateUrl: './annotation.component.html',
  styleUrls: ['./annotation.component.css']
})
export class AnnotationComponent implements OnInit {

  data: any;
  snippets: Snippet[];
  annotationForm: FormGroup;
  private handleError: HandleError;

  // Getter used to retrieve the list of snippet inputs
  get snippetInputs() {
    return this.annotationForm.get('snippetInputs') as FormArray;
  }

  constructor(private router: Router, private fb: FormBuilder, private http: HttpClient, httpErrorHandler: HttpErrorHandler) {
    this.snippets = [
      {
        id: 0,
        url: 'data:image/jpeg;base64,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',
        value: 'waving'
      },
      {
        id: 1,
        url: 'data:image/jpeg;base64,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',
        value: 'traveler'
      },
      {
        id: 2,
        url: 'data:image/jpeg;base64,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',
        value: 'noot potatoe'
      }
    ];

    this.handleError = httpErrorHandler.createHandleError('Annotation');

    this.annotationForm = this.fb.group({
      snippetInputs: this.fb.array([])
    });
  }

  ngOnInit() {
    this.fillAnnotationForm();
  }

  fillAnnotationForm() {
    this.snippets.forEach(snippet => {
      this.snippetInputs.push(this.fb.control(snippet.value));
    });
  }

  onSubmit(annotationFormData: any) {
    // Update snippets' value based on user inputs
    const modifiedSnippetInputs = annotationFormData.snippetInputs;
    for (let i = 0; i < modifiedSnippetInputs.length; i++) {
      this.snippets[i].value = modifiedSnippetInputs[i];
    }
    this.snippetInputs.clear();
    this.retrieveSnippets();
  }

  /// HTTP
  retrieveSnippets() {
    this.http.get<Snippet[]>('db/retrieve/snippets/20')
      .pipe(
        catchError(this.handleError('getSnippets', []))
      )
      .subscribe(returnedData => {
        this.snippets = returnedData;
      });
  }

}
